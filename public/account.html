<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Account - Epick Chat</title>
<style>
  body{font-family:Arial;background:#071021;color:#e8eefc;padding:24px}
  .card{background:rgba(255,255,255,0.03);padding:18px;border-radius:10px;max-width:540px}
  .pfp{width:96px;height:96px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.06)}
  input[type=file]{margin-top:10px}
  button{margin-top:10px;padding:8px 12px;border-radius:8px;border:none;background:#6b8cff;color:#05102a;cursor:pointer}
</style>
</head>
<body>
  <div class="card">
    <h2>Account</h2>
    <img id="pfp" class="pfp" src="/avatars/default.png">
    <form id="avatarForm" enctype="multipart/form-data">
      <input type="file" name="avatar" accept="image/*">
      <button type="submit">Upload avatar (gif supported)</button>
    </form>
    <div style="margin-top:14px">
      <button id="back">Back to chat</button>
    </div>
  </div>

<script>
async function init(){
  const res = await fetch('/me');
  const j = await res.json();
  if(!j.loggedIn) return location.href='/login.html';
  document.getElementById('pfp').src = j.avatar || '/avatars/default.png';
}
document.getElementById('avatarForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch('/update-avatar', { method:'POST', body: fd });
  const j = await res.json();
  if(j.success){
    document.getElementById('pfp').src = j.avatar + '?t=' + Date.now();
    alert('Avatar updated');
  } else alert(j.message || 'Failed');
});
document.getElementById('back').onclick = () => location.href = '/';
init();
</script>
</body>
</html>
