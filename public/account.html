<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Account - EpickChat</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="account-container">
    <h2>Account Settings</h2>
    <img id="pfp" src="/avatars/default.png" class="avatar-large" alt="avatar">
    <form id="avatarForm">
      <label>Upload avatar (image / gif)</label>
      <input type="file" id="avatarFile" name="avatar" accept="image/*">
      <button type="button" id="uploadBtn">Upload</button>
    </form>

    <div>
      <label>Or use image/GIF URL</label>
      <input id="avatarUrl" placeholder="https://...gif or .png or .jpg">
      <button id="setUrlBtn">Set from URL</button>
    </div>

    <div>
      <button onclick="location.href='/index.html'">Back to Chat</button>
    </div>
  </div>

<script>
(async ()=>{
  const res = await fetch('/me'); const data = await res.json();
  if (!data.loggedIn) location.href = '/login.html';
  document.getElementById('pfp').src = data.avatar || '/avatars/default.png';

  document.getElementById('uploadBtn').onclick = async ()=>{
    const file = document.getElementById('avatarFile').files[0];
    if (!file) return alert('Choose a file');
    const fd = new FormData(); fd.append('avatar', file);
    const r = await fetch('/update-avatar', { method:'POST', body: fd });
    const j = await r.json();
    if (j.success) {
      document.getElementById('pfp').src = j.avatar;
      alert('Avatar updated');
    } else alert(j.message || 'Failed');
  };

  document.getElementById('setUrlBtn').onclick = async ()=>{
    const url = document.getElementById('avatarUrl').value.trim();
    if (!url) return alert('Enter URL');
    const r = await fetch('/update-avatar', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ avatarUrl: url })});
    const j = await r.json();
    if (j.success) {
      document.getElementById('pfp').src = j.avatar;
      alert('Avatar updated');
    } else alert(j.message || 'Failed');
  };
})();
</script>
</body>
</html>
