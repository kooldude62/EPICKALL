<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Account Settings</title>
</head>
<body>
<h2>Account Settings</h2>
<img id="pfp" src="" width="100" style="border-radius:50%">
<form id="avatarForm">
  <input type="file" name="avatar" accept="image/*" required>
  <button type="submit">Update Avatar</button>
</form>
<button onclick="window.location.href='/index.html'">Back to Chat</button>

<script>
async function init(){
  const res = await fetch("/me");
  const data = await res.json();
  if(!data.loggedIn) window.location.href="/login.html";
  document.getElementById("pfp").src = data.avatar;
}

document.getElementById("avatarForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch("/update-avatar", { method:"POST", body: formData });
  const data = await res.json();
  if(data.success) document.getElementById("pfp").src = data.avatar;
  else alert(data.message || "Upload failed");
});

init();
</script>
</body>
</html>
